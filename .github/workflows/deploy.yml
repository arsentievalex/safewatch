name: Deploy Streamlit App to Azure

on:
  push:
    branches:
      - main  # Trigger deployment when pushing to the main branch

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Check out repository
        uses: actions/checkout@v3

      - name: Log in to Azure
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: Deploy ARM template
        uses: azure/arm-deploy@v1
        with:
          subscriptionId: '9b6b2d1a-dc93-4ec5-9e33-d2925a1c9f4c'
          resourceGroupName: 'rg-arsentiev9393-0970_ai'
          template: 'infra/template.json'
          parameters: 'infra/parameters.json'
          deploymentMode: Incremental

      - name: Deploy Streamlit App code to Azure App Service
        uses: azure/webapps-deploy@v2
        with:
          app-name: 'safewatch'  # Match the app name in template.json
          package: '.'  # Deploy the entire repository (assumes app.py is at root)
